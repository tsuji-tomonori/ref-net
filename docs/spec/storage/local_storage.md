# ローカルストレージ仕様書

## 1. 概要

本仕様書は、ObsidianによるRAG論文関係性の可視化システムにおけるローカルストレージの利用方法と管理について定義する。
ローカルストレージは、Obsidianで直接読み込み可能なMarkdownファイルの保存先として使用される。

## 2. ストレージ構成

### 2.1 基本ディレクトリ構成

```
./output/                    # ルートディレクトリ（Docker Volume）
├── papers/                  # 論文Markdownファイル
│   ├── {paper_id}.md       # 個別論文ファイル
│   └── ...
├── attachments/            # 添付ファイル（将来拡張用）
│   ├── images/            # 図表画像
│   └── pdfs/              # PDF原文（オプション）
└── .obsidian/             # Obsidian設定（自動生成）
    └── graph.json         # グラフビュー設定
```

### 2.2 ファイル命名規則

#### 論文Markdownファイル
- パターン: `{paper_id}.md`
- 例: `204e3073870fae3d05bcbc2f6a8e263d10af1e8b.md`
- paper_id: Semantic Scholar論文ID（40文字の16進数文字列）

#### 添付ファイル（将来拡張）
- 画像: `{paper_id}_{type}_{index}.{ext}`
- PDF: `{paper_id}.pdf`

## 3. Markdownファイル仕様

### 3.1 ファイル構造

```markdown
---
# Obsidian用フロントマター
title: "論文タイトル"
authors: ["著者1", "著者2"]
year: 2024
paper_id: "204e3073870fae3d05bcbc2f6a8e263d10af1e8b"
citation_count: 150
abstract: "論文の要約テキスト"
tags:
  - RAG
  - NLP
  - MachineLearning
created: "2024-01-20T10:00:00Z"
updated: "2024-01-21T15:30:00Z"
---

# 論文タイトル

## 基本情報
- **著者**: 著者1, 著者2
- **発表年**: 2024
- **引用数**: 150
- **分野**: Machine Learning, NLP

## 概要
{abstract}

## AI要約
{ai_summary}

## キーワード
- {keyword1}
- {keyword2}

## 引用関係
### この論文が引用している論文
- [[paper_id_1]]
- [[paper_id_2]]

### この論文を引用している論文
- [[paper_id_3]]
- [[paper_id_4]]

## 外部リンク
- [Semantic Scholar](https://www.semanticscholar.org/paper/{paper_id})
- [PDF]({pdf_url})
```

### 3.2 Obsidian連携機能

- **内部リンク**: `[[paper_id]]`形式で他の論文への参照
- **タグ**: `#RAG`形式で分野・トピックの分類
- **グラフビュー**: フロントマターの`references`と`citations`を基に自動構築

## 4. 容量設計

### 4.1 ファイルサイズ見積もり

| 項目 | サイズ |
|------|--------|
| 論文Markdownファイル（平均） | 5KB |
| 論文Markdownファイル（最大） | 20KB |
| 添付画像（平均） | 200KB |
| PDF原文（平均） | 2MB |

### 4.2 スケーラビリティ

| 論文数 | Markdown容量 | 添付ファイル容量（想定） | 合計容量 |
|--------|--------------|------------------------|----------|
| 1,000 | 5MB | 200MB | 205MB |
| 10,000 | 50MB | 2GB | 2.05GB |
| 100,000 | 500MB | 20GB | 20.5GB |

### 4.3 推奨ディスク容量

- 最小: 1GB（論文1,000件程度）
- 推奨: 10GB（論文10,000件+添付ファイル）
- 最大: 50GB（論文100,000件+完全なPDF保存）

## 5. アクセスパターン

### 5.1 書き込みパターン
- Paper Processor: 新規ファイル作成（1回のみ）
- PDF Summarizer: 既存ファイルの更新（AI要約セクション）

### 5.2 読み込みパターン
- Obsidian: ファイル全体の読み込み（起動時）
- Obsidian: 個別ファイルの読み込み（編集・閲覧時）

## 6. バックアップ・復旧

### 6.1 バックアップ戦略
- Gitによるバージョン管理（オプション）
- 定期的な圧縮アーカイブ作成
- クラウドストレージへの同期（Obsidian Sync等）

### 6.2 復旧手順
1. PostgreSQLから論文メタデータを再取得
2. Markdown Generatorで全ファイル再生成
3. 既存のAI要約情報をマージ

## 7. パフォーマンス最適化

### 7.1 ファイルシステム推奨事項
- ext4またはBtrfs（Linux）
- APFS（macOS）
- NTFS（Windows）

### 7.2 Obsidianパフォーマンス
- 10,000ファイルまで: 快適に動作
- 50,000ファイルまで: 動作可能（初回読み込みに時間）
- 50,000ファイル以上: フォルダ分割推奨

## 8. セキュリティ考慮事項

### 8.1 アクセス制御
- Dockerボリュームは読み書き可能（rw）
- ホストマシンのユーザー権限で管理

### 8.2 機密情報
- PDFファイルは著作権に配慮
- 個人情報・機密情報は保存しない

## 9. 監視・メンテナンス

### 9.1 監視項目
- ディスク使用率
- ファイル数
- 最終更新日時

### 9.2 メンテナンス
- 古いファイルのアーカイブ（1年以上未更新）
- 重複ファイルの削除
- 破損ファイルの検出・修復
