# コーディング規約

## 基本方針

- PEP 8に準拠する。可読性と一貫性を最重視。
- PEP 8と本規約が矛盾する場合は本規約を優先する。
- ruffでLintチェック、mypyで型チェックを実施。提出前に両方のエラーがないことを確認。

## コードレイアウト

### インデントと空白

- インデント: スペース4つ。タブ禁止。
- 空白規則:
  - 括弧の内側直後・直前：スペースなし
  - カンマ・コロン・セミコロン：直前なし、直後1つ
  - 二項演算子：両側に1つ
  - キーワード引数の`=`：前後なし
  - 行末の空白：禁止

### 行の長さと改行

- 行の長さ: 原則79文字以内、最大88文字まで許容。コメント・Docstringは72文字程度。
- 改行位置: 演算子の前で改行（Knuthスタイル）。継続行はインデント+4スペースか開きカッコに揃える。
- 空行: トップレベル関数・クラス前後は2行、メソッド間は1行。
- ステートメント: 1行1文。複合文は禁止（`if __name__ == "__main__":`除く）。

### ソースファイルとエンコーディング

- エンコーディング: UTF-8。宣言不要。
- モジュール構成: モジュールレベル定義と実行ブロック（`if __name__ == "__main__":`）を明確に分離。

## インポート規則

- 配置: ファイル先頭（Docstring直後、定数定義前）
- 書式: 1import文1モジュール。同一モジュールからの複数インポートは可。
- 順序:
  1. 標準ライブラリ
  2. サードパーティ
  3. アプリケーション固有
  （各グループ間に空行）
- 絶対インポート優先。相対インポートは複雑な構成時のみ。
- ワイルドカード禁止: `from module import *`は使用不可。
- 特殊変数: `__all__`等はDocstring直後、import前。`__future__`は最優先。

## 命名規則

- パッケージ・モジュール: 全小文字。モジュール名は`_`可。
- クラス: CapWords（CamelCase）
- 関数・変数: snake_case（全小文字、`_`区切り）
- 定数: 全大文字、`_`区切り（例: `MAX_COUNT`）
- 例外クラス: CapWords + 末尾「Error」。`Exception`から継承。
- メソッド引数: インスタンス→`self`、クラス→`cls`。キーワード衝突時は末尾`_`。
- 非公開: 先頭`_`。名前マングリングは`__`（必要時のみ）。
- 禁止文字: `l`、`O`、`I`（紛らわしい単一文字）

## コメントとDocstring

- コメント原則: 意図・注意点のみ記述。自明な内容は不要。コメントアウトしたコードは残さない。
- ブロックコメント: `#` + スペース。同一インデント。段落区切りは`#`のみの行。
- インラインコメント: コードから2スペース以上。最小限に。
- Docstring: 公開モジュール・関数・クラス・メソッドに必須。三重引用符使用。
  - 一行：`"""要約"""`
  - 複数行：要約→空行→詳細

## 型ヒントと静的解析

- 必須: 全関数・メソッドにPEP 484準拠の型ヒントを記述。mypyでチェック。
- 最新構文使用:
  - 組み込み型を直接使用（`list`、`dict`等。`typing.List`は非推奨）
  - Union型は`|`演算子（例: `str | None`）
- 記法:
  - 型変数：CapWords（例: `T`、`AnyStr`）
  - Noneを許容：`| None`を明示
  - 戻り値なし：`-> None`
  - `__init__`：必ず`-> None`
  - 型チェック無効化：`# type: ignore`（例外的使用のみ）
- 前方参照: `from __future__ import annotations`推奨

## その他の推奨事項

### 比較とチェック
- None比較: `is`/`is not`使用（`==`禁止）
- 真偽値: 直接評価（`if cond:`）。`== True`/`== False`禁止
- シーケンス空判定: `if not seq:`/`if seq:`（`len()`比較禁止）
- 型チェック: `isinstance()`使用（`type()`比較禁止）

### リソース管理とコーディング
- リソース管理: `with`文使用
- return文: 一貫性保持。値を返す場合は全分岐で明示
- 文字列操作: 組み込みメソッド使用。`startswith()`/`endswith()`推奨
- lambda: 変数代入禁止。名前付き関数は`def`使用
- 比較演算実装: 全演算子を整合的に実装または`functools.total_ordering`使用
- プロパティ: 単純なgetter/setterは`@property`使用

### 例外処理
- 裸のexcept禁止: 具体的な例外クラス指定
- 例外チェーン: `raise ... from ...`構文使用
- tryブロック: 必要最小限のコードのみ
- except節: `except SomeError as e:`形式。複数は`except (Error1, Error2):`
- カスタム例外: `Exception`継承、末尾「Error」
